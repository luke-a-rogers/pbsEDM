---
title: "Analyse a Simple Time Series"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{simple_time_series}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 6,
  fig.height = 6
)
```

```{r setup}
library(pbsEDM)
```

The tibble `Nx_lags_orig` is saved in the package and contains a simple time
series $N(t)$ as `Nt`, the lagged value $N(t-1)$ as `Ntmin1`, and first difference
$X(t) = N(t+1) - N(t)$ as `Xt` (and `Xtmin1` and `Xtmin2` the lagged
values). Also has results for embedding dimension 2, using both `rEDM` and Andy's original
function `EDM_pred_E_2()`. See `?Nx_lags_orig` for full details.

Using that as an example here, see `inclusion_issue.Rmd` vignette for comparison
of Andy's original results with results from `pbsEDM` and `rEDM`.

## Analyse with pbsEDM code

Use only the `Nt` raw data column from `Nx_lags_orig` and apply EDM
calculations using lags of 0 and 1 with first differencing:
```{r calc2}
calc2 <- pbsEDM(Nx_lags_orig,
                lags = list(Nt = c(0:1)),
                first_difference = TRUE)
```
Creates a list of results (see `?pbsEDM` for full details):
```{r res}
summary(calc2)
```
which can be used to plot the data in various useful ways:
```{r plotres, fig.width = 9, fig.height = 5.36}
plot(calc2,
     portrait = FALSE)
```

TODO add caption


```{r, eval=FALSE, echo=FALSE}
# ```{r, animation.hook = 'gifski', interval = 1.5, fig.width = 5.36, fig.height = 8}
## fig.width is 0.67 * fig.height (which is 8)

for(iiii in 1:length(Nx_lags_orig$Nt)){
  plot(calc2,
       last.time.to.plot = iiii)
}
```

Instructive to have as a movie, just showing the data for now:
<!--
And again in landscape mode (for presentations):-->
```{r, animation.hook = 'gifski', interval = 1.5, fig.width = 9, fig.height = 5.36}
# ```{r, eval=FALSE, echo=FALSE}
for(iiii in 1:length(Nx_lags_orig$Nt)){
  plot(calc2,
       last.time.to.plot = iiii,
       portrait = FALSE)
}
```



## Make forecasts using different values of E

Using the simplex algorithm for different values of embedding dimension $E$
($E=2$ uses first-difference values $X_t$ and $X_{t-1}$).
```{r Eres, fig.width = 9, fig.height = 5.36}
E_results <- pbsEDM_Evec(Nx_lags_orig$Nt)
plot_pbsEDM_Evec(E_results,
                 portrait = FALSE)
```

And a movie of that (not run here as gifski causes Travis fails, see [here](https://htmlpreview.github.io/?https://raw.githubusercontent.com/andrew-edwards/sizeSpectra/master/doc/MEPS_IBTS_recommend.html) for an explanation):
<!-- # made width 9 not 8 to see axis labels better-->
```{r, animation.hook = 'gifski', interval = 1.5, fig.width = 9, fig.height = 5.36}
# ```{r, eval=FALSE, echo=FALSE}
for(iiii in 1:length(Nx_lags_orig$Nt)){
  plot_pbsEDM_Evec(E_results,
       last.time.to.plot = iiii,
       portrait = FALSE)
}
```

<!-- ![pbsEDM_movie_1.gif](pbsEDM_movie_1.gif).-->

See how the forecast skill (correlation coefficient $\rho$) varies with $E$:
```{r rhoE}
plot_rho_Evec(E_results)
```

## Movie to demonstrate how EDM works

With $t^* = 39$, shows the idea:
<!-- ```{r, eval = FALSE} -->
```{r, EDMmovie, animation.hook = 'gifski', interval = 8}
plot_explain_edm_movie(calc2,
                       tstar = 39)  # 15 shows the idea nicely
                                    # 75, 94 seem biggest difference to rEDM
```

Now with $t^* = 75$ get difference to rEDM (bit hard to see though):
```{r, EDMmovie2, animation.hook = 'gifski', interval = 5}
plot_explain_edm_movie(calc2,
                       tstar = 75)  # 15 shows the idea nicely
                                    # 75, 94 seem biggest difference to rEDM
